# Maintainer: Maxime Gauduin <alucryd@archlinux.org>
# Contributor: Mike Swanson <mikeonthecomputer@gmail.com>
# Contributor: Themaister <maister@archlinux.us>

pkgname=retroarch-git
pkgver=1.5.0.r1078.25210d5f2
pkgrel=1
pkgdesc='Reference frontend for the libretro API'
arch=('i686' 'x86_64')
url='http://www.libretro.com/'
license=('GPL')
groups=('libretro')
depends=('alsa-lib' 'freetype2' 'glibc' 'libdrm' 'libgl' 'libpulse'
         'libusb' 'libx11' 'libxext' 'libxinerama' 'libxkbcommon' 'libxv'
         'libxxf86vm' 'mesa' 'openal' 'python' 'sdl2' 'wayland' 'zlib'
         'libavcodec.so' 'libavformat.so' 'libavutil.so' 'libswresample.so'
         'libswscale.so' 'libudev.so')
makedepends=('git')
optdepends=('libretro-bsnes: Super Nintendo Entertainment System cores'
            'libretro-desmume: Nintendo DS core'
            'libretro-gambatte: Nintendo Game Boy/Game Boy Color core'
            'libretro-genesis-plus: Sega Master System/Genesis/Game Gear/CD/32X core'
            'libretro-mgba: Nintendo Game Boy Advance core'
            'libretro-mupen64plus: Nintendo 64 core'
            'libretro-nestopia: Nintendo Entertainment System core'
            'libretro-pcsx-rearmed: Sony PlayStation core'
            'libretro-ppsspp: Sony PlayStation Portable core'
            'libretro-snes9x: Super Nintendo Entertainment System core'
            'libretro-yabause: Sega Saturn core'
            'libretro-overlays: Collection of overlays'
            'libretro-shaders: Collection of shaders')
provides=('retroarch')
conflicts=('retroarch')
backup=('etc/retroarch.cfg')
source=('retroarch::git+https://github.com/libretro/RetroArch.git'
        'retroarch-gcc710.patch::https://github.com/alucryd/RetroArch/commit/f3453500d4fe01e6fde347d2e28e376cb8ea5c82.patch'
        'retroarch-paths.patch')
sha256sums=('SKIP'
            '564c543e6fe8e95691c8ef47848a95035fc52af9cd8a2dcdf66375a9a4a09035'
            'a8449fc210b3f55e2189e8b1106e5a8adaa359916e692af424d838b468ab3da0')

pkgver() {
  cd retroarch

  git describe --tags | sed 's/v//; s/-/.r/; s/-g/./'
}

prepare() {
  cd retroarch

  patch -Np1 -i ../retroarch-gcc710.patch
  patch -Np1 -i ../retroarch-paths.patch
}

build() {
  cd retroarch

  ./configure \
    --prefix='/usr' \
    --disable-cg \
    --disable-jack \
    --disable-oss
  make
}

package() {
  cd retroarch

  make DESTDIR="${pkgdir}" install
}

# vim: ts=2 sw=2 et:
